<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhyxcs.xxzz.mapper.SupervisionMapper">
  <resultMap id="BaseResultMap" type="com.zhyxcs.xxzz.domain.Supervision">
    <constructor>
      <idArg column="sTransactionNum" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sAccountNum" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sDepositorName" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sUniqueSocialCreditCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sApprovalCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sBusinessDate" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sBusinessCertificateDate" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sRelatedTransctionNum" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sKind" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sApprovalState" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sCommitTimes" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sReturnTimes" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sPBCReturnTimes" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sCompleteTimes" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sBusinessCategory" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sAccountType" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sBankCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sPBCBankCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sBankName" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sUpUserCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sUpUserName" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sStartTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sEndTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="sReviewUserCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sCheckUserCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sRecheckUserCode" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sRecheckResult" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sRecheckOpinion" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sRecheckTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
    </constructor>
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from tsupervision
    where sTransactionNum = #{stransactionnum,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.zhyxcs.xxzz.domain.Supervision">
    insert into tsupervision (sTransactionNum, sAccountNum, sDepositorName, 
      sUniqueSocialCreditCode, sApprovalCode, 
      sBusinessDate, sBusinessCertificateDate, 
      sRelatedTransctionNum, sKind, sApprovalState, 
      sCommitTimes, sReturnTimes, sPBCReturnTimes, 
      sCompleteTimes, sBusinessCategory, sAccountType, 
      sBankCode, sPBCBankCode, sBankName, 
      sUpUserCode, sUpUserName, sStartTime, 
      sEndTime, sReviewUserCode, sCheckUserCode, 
      sRecheckUserCode, sRecheckResult, sRecheckOpinion, 
      sRecheckTime)
    values (#{stransactionnum,jdbcType=VARCHAR}, #{saccountnum,jdbcType=VARCHAR}, #{sdepositorname,jdbcType=VARCHAR}, 
      #{suniquesocialcreditcode,jdbcType=VARCHAR}, #{sapprovalcode,jdbcType=VARCHAR}, 
      #{sbusinessdate,jdbcType=TIMESTAMP}, #{sbusinesscertificatedate,jdbcType=TIMESTAMP}, 
      #{srelatedtransctionnum,jdbcType=VARCHAR}, #{skind,jdbcType=VARCHAR}, #{sapprovalstate,jdbcType=VARCHAR}, 
      #{scommittimes,jdbcType=TIMESTAMP}, #{sreturntimes,jdbcType=TIMESTAMP}, #{spbcreturntimes,jdbcType=TIMESTAMP}, 
      #{scompletetimes,jdbcType=TIMESTAMP}, #{sbusinesscategory,jdbcType=VARCHAR}, #{saccounttype,jdbcType=VARCHAR}, 
      #{sbankcode,jdbcType=VARCHAR}, #{spbcbankcode,jdbcType=VARCHAR}, #{sbankname,jdbcType=VARCHAR}, 
      #{supusercode,jdbcType=VARCHAR}, #{supusername,jdbcType=VARCHAR}, #{sstarttime,jdbcType=TIMESTAMP}, 
      #{sendtime,jdbcType=TIMESTAMP}, #{sreviewusercode,jdbcType=VARCHAR}, #{scheckusercode,jdbcType=VARCHAR}, 
      #{srecheckusercode,jdbcType=VARCHAR}, #{srecheckresult,jdbcType=VARCHAR}, #{srecheckopinion,jdbcType=VARCHAR}, 
      #{srechecktime,jdbcType=TIMESTAMP})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.zhyxcs.xxzz.domain.Supervision">
    update tsupervision
    set sAccountNum = #{saccountnum,jdbcType=VARCHAR},
      sDepositorName = #{sdepositorname,jdbcType=VARCHAR},
      sUniqueSocialCreditCode = #{suniquesocialcreditcode,jdbcType=VARCHAR},
      sApprovalCode = #{sapprovalcode,jdbcType=VARCHAR},
      sBusinessDate = #{sbusinessdate,jdbcType=TIMESTAMP},
      sBusinessCertificateDate = #{sbusinesscertificatedate,jdbcType=TIMESTAMP},
      sRelatedTransctionNum = #{srelatedtransctionnum,jdbcType=VARCHAR},
      sKind = #{skind,jdbcType=VARCHAR},
      sApprovalState = #{sapprovalstate,jdbcType=VARCHAR},
      sCommitTimes = #{scommittimes,jdbcType=TIMESTAMP},
      sReturnTimes = #{sreturntimes,jdbcType=TIMESTAMP},
      sPBCReturnTimes = #{spbcreturntimes,jdbcType=TIMESTAMP},
      sCompleteTimes = #{scompletetimes,jdbcType=TIMESTAMP},
      sBusinessCategory = #{sbusinesscategory,jdbcType=VARCHAR},
      sAccountType = #{saccounttype,jdbcType=VARCHAR},
      sBankCode = #{sbankcode,jdbcType=VARCHAR},
      sPBCBankCode = #{spbcbankcode,jdbcType=VARCHAR},
      sBankName = #{sbankname,jdbcType=VARCHAR},
      sUpUserCode = #{supusercode,jdbcType=VARCHAR},
      sUpUserName = #{supusername,jdbcType=VARCHAR},
      sStartTime = #{sstarttime,jdbcType=TIMESTAMP},
      sEndTime = #{sendtime,jdbcType=TIMESTAMP},
      sReviewUserCode = #{sreviewusercode,jdbcType=VARCHAR},
      sCheckUserCode = #{scheckusercode,jdbcType=VARCHAR},
      sRecheckUserCode = #{srecheckusercode,jdbcType=VARCHAR},
      sRecheckResult = #{srecheckresult,jdbcType=VARCHAR},
      sRecheckOpinion = #{srecheckopinion,jdbcType=VARCHAR},
      sRecheckTime = #{srechecktime,jdbcType=TIMESTAMP}
    where sTransactionNum = #{stransactionnum,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select sTransactionNum, sAccountNum, sDepositorName, sUniqueSocialCreditCode, sApprovalCode, 
    sBusinessDate, sBusinessCertificateDate, sRelatedTransctionNum, sKind, sApprovalState, 
    sCommitTimes, sReturnTimes, sPBCReturnTimes, sCompleteTimes, sBusinessCategory, sAccountType, 
    sBankCode, sPBCBankCode, sBankName, sUpUserCode, sUpUserName, sStartTime, sEndTime, 
    sReviewUserCode, sCheckUserCode, sRecheckUserCode, sRecheckResult, sRecheckOpinion, 
    sRecheckTime
    from tsupervision
    where sTransactionNum = #{stransactionnum,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select sTransactionNum, sAccountNum, sDepositorName, sUniqueSocialCreditCode, sApprovalCode, 
    sBusinessDate, sBusinessCertificateDate, sRelatedTransctionNum, sKind, sApprovalState, 
    sCommitTimes, sReturnTimes, sPBCReturnTimes, sCompleteTimes, sBusinessCategory, sAccountType, 
    sBankCode, sPBCBankCode, sBankName, sUpUserCode, sUpUserName, sStartTime, sEndTime, 
    sReviewUserCode, sCheckUserCode, sRecheckUserCode, sRecheckResult, sRecheckOpinion, 
    sRecheckTime
    from tsupervision
  </select>

  <insert id="newSupervision" parameterType="com.zhyxcs.xxzz.domain.Supervision" statementType="CALLABLE">
    {
        call generate_sv_serial_number_by_bankcode(
         #{sbankcode, mode=IN,jdbcType=VARCHAR},
         #{sdepositorname, mode=IN,jdbcType=VARCHAR},
         #{sbusinesscategory, mode=IN,jdbcType=VARCHAR},
         #{saccounttype, mode=IN,jdbcType=VARCHAR},
         #{sbankname, mode=IN,jdbcType=VARCHAR},
         #{supusercode, mode=IN,jdbcType=VARCHAR},
         #{supusername, mode=IN,jdbcType=VARCHAR},
         #{sapprovalcode, mode=IN,jdbcType=VARCHAR},
         #{saccountnum, mode=IN,jdbcType=VARCHAR},
         #{suniquesocialcreditcode, mode=IN,jdbcType=VARCHAR},
         #{stransactionnum, mode=OUT,jdbcType=VARCHAR}
        )
    }
</insert>

  <select id="queryRecordByPageAndUserCodeBankEntry" resultType="com.zhyxcs.xxzz.domain.Supervision">
    select * from tsupervision
    where
    <choose>
      <when test="approvalState == 4 or approvalState == 5">
        (sApprovalState = '4' or sApprovalState = '5')
      </when>
       <otherwise>
         sApprovalState = #{approvalState,jdbcType=VARCHAR}
       </otherwise>
    </choose>
    and sUpUserCode = #{userCode,jdbcType=VARCHAR}
    <if test="depositorName != null and depositorName != ''">
      and sDepositorName like CONCAT('%',#{depositorName} ,'%')
    </if>
    <if test="businessType != null and businessType != ''">
      and sBusinessCategory = #{businessType}
    </if>
    order by sStartTime desc
  </select>
  <select id="queryRecordByPageAndUserCodeBankCharge" resultType="com.zhyxcs.xxzz.domain.Supervision">
    select * from tsupervision
    where
    sApprovalState = #{approvalState,jdbcType=VARCHAR}
    and
    sBankCode = #{bankCode,jdbcType=VARCHAR}
      <choose>
          <when test="approvalState == 2">
              and (sReviewUserCode = #{userCode} or sReviewUserCode is null)
          </when>
          <otherwise>
              and sReviewUserCode = #{userCode}
          </otherwise>
      </choose>
      order by sEndTime desc
  </select>
  <select id="queryRecordByPageAndUserCodeRenEntry" resultType="com.zhyxcs.xxzz.domain.Supervision">
    select * from tsupervision
    where
    sApprovalState = #{approvalState,jdbcType=VARCHAR}
    and
    sPBCBankCode = #{pbcCode,jdbcType=VARCHAR}
      <choose>
        <when test="approvalState == 3">
          and (sCheckUserCode = #{userCode} or sCheckUserCode is null)
        </when>
        <otherwise>
          and sCheckUserCode = #{userCode,jdbcType=VARCHAR}
        </otherwise>
      </choose>
    <if test="bankCode != null">
      and sBankCode = #{bankCode,jdbcType=VARCHAR}
    </if>
    <choose>
      <when test="approvalState == 3">
        order by sCommitTimes desc
      </when>
      <otherwise>
        order by sCommitTimes asc
      </otherwise>
    </choose>
  </select>
  <!--<select id="queryRecordByPageAndUserCodeRenCharge" resultType="com.zhyxcs.xxzz.domain.Supervision">-->

  <!--</select>-->

  <update id="updateApprovalStateNameByPrimaryKey" parameterType="com.zhyxcs.xxzz.domain.Supervision">
    update tsupervision
    set sApprovalState = #{supervision.sapprovalstate,jdbcType=VARCHAR}
      <if test="action == 'commit'">
      , sEndTime = #{supervision.sendtime, jdbcType=TIMESTAMP}
      </if>
      <if test="action == 'commit_ren'">
      , sEndTime = #{supervision.sendtime, jdbcType=TIMESTAMP}
      , sCommitTimes = #{supervision.scommittimes, jdbcType=TIMESTAMP}
      </if>
      <if test="action == 'review'">
      , sReviewUserCode = #{supervision.sreviewusercode, jdbcType=VARCHAR}
      , sCommitTimes = #{supervision.scommittimes, jdbcType=TIMESTAMP}
      </if>
      <if test="action == 'send_back'">
        , sReviewUserCode = #{supervision.sreviewusercode, jdbcType=VARCHAR}
        , sReturnTimes = #{supervision.sreturntimes, jdbcType=TIMESTAMP}
      </if>
      <if test="action == 'check'">
        , sCheckUserCode = #{supervision.scheckusercode, jdbcType=VARCHAR}
        , sCompleteTimes = #{supervision.scompletetimes, jdbcType=VARCHAR}
      </if>
    where sTransactionNum = #{supervision.stransactionnum,jdbcType=VARCHAR}
  </update>

  <select id="queryRecordTotalNum" resultType="int">
    select count(sTransactionNum)
    from tsupervision
    where sApprovalState = #{approvalState,jdbcType=VARCHAR}
    <if test="userLevel == 1">
      and sUpUserCode = #{userCode,jdbcType=VARCHAR} and sBankCode = #{bankCode,jdbcType=VARCHAR}
    </if>
    <if test="userLevel == 2">
      <choose>
        <when test="approvalState == 2">
          and (sReviewUserCode = #{userCode} or sReviewUserCode is null)
        </when>
        <otherwise>
          and sReviewUserCode = #{userCode}
        </otherwise>
      </choose>
      and sBankCode = #{bankCode,jdbcType=VARCHAR}
    </if>
  </select>

  <update id="occupyTransaction" parameterType="com.zhyxcs.xxzz.domain.Supervision">
    update tsupervision
    set sReviewUserCode = #{sreviewusercode,jdbcType=VARCHAR},
    sCheckUserCode = #{scheckusercode,jdbcType=VARCHAR},
    sRecheckUserCode = #{srecheckusercode,jdbcType=VARCHAR}
    where sTransactionNum = #{stransactionnum,jdbcType=VARCHAR}
    </update>
</mapper>